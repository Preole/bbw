/*!
 * @desc BakaBakaMark: An Extensible LML-HTML Compiler
 * @version 1.0.0
 * @license BSD-2-Clause; Copyright (c) 2014 Preole, All rights reserved.
*/
var BBM=function(){"use strict";function a(a){for(var b=[],c=0,d=a.length;d>c;c+=1)b.push(A.CSS_PRE+i(a[c]));return b.join(M)}function b(a,b){return A.CSS_PRE_ID+(b?i(a):a)}function c(a){return F.lastIndex=0,a.replace(F,"")}function d(a){return I.lastIndex=0,a.replace(I,"")}function e(a){return H.lastIndex=0,a.replace(H,"")}function f(a){return a.replace(/(^\s+)|(\s+$)/g,"")}function g(a){return a.replace(/\s+$/g,"")}function h(a){return m(f(d(a)))}function i(a){return c(d(a))}function j(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}function k(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(a){return j(f(d(a))).replace(/`/g,"&#x60;")}function m(a){return a.replace(/^javascript:/i,"javascript;").replace(/^data:/i,"data;")}function n(a,b){var c="";if(0>=b)return c;for(;1&b&&(c+=a),b>>=1,b;)a+=a;return c}function o(a,b,c){var d=(a.length>>>0)-1,e=c?c:d;if(0>e)return-1;for(e>a.length-1&&(e=d),e;e>=0&&a[e]!==b;e-=1);return e}function p(a,b,c){for(var d=[],e=0,f=a.length>>>0;f>e;e+=1){var g=a[e];b.call(c,g,e,a)&&d.push(g)}return d}function q(){var a=Array.prototype.slice.call(arguments,0),b=0,c=a.length,d=Object.prototype.hasOwnProperty,e=null;for(b=0;c>b&&(e=a[b],!(e instanceof Object));b+=1);for(b+=1;c>b;b+=1)if("object"==typeof a[b]||"function"==typeof a[b])for(var f in a[b])d.call(a[b],f)&&(e[f]=a[b][f]);return e}function r(a,b,c){this.col=c,this.lexeme=b,this.type=a}function s(a,b){this.children=[],this.type=a,this.err=!1,this.meta=b||{},this.parent=null,this.isDeleted=!1}function t(a){function b(b){return a.charAt(Y+(b||0))}function c(b){var c=a.substring(Y+1,b.length+Y+1);return c===b}function d(a){return E.test(b(a))}function e(a){return G.test(b(a))||""===b(a)}function f(a){return e(a)||d(a)}function g(b){b=Math.abs(b||1),Y+=b,X+=b,Z=a.charAt(Y)}function h(b){b=Math.abs(b||1),W+=b,Y+=b,Z=a.charAt(Y)}function i(){return""!==Z}function j(b){var c=a.substring(W,Y),d=U[U.length-1];d&&d.isType(N.TEXT)&&b===N.TEXT?($=d,d.lexeme+=c):($=new r(b,c,V),U.push($))}function k(){d(1)&&(g(2),j(N.UL_ITEM))}function l(){if(c("-}"))g(3),j(N.DEL_END);else if(c("---")){for(;"-"===Z;)g();e()&&j(N.DIV_LINE)}else"["===b(1)?(g(2),j(N.LINK_CONT)):d(1)&&(g(2),j(N.UL_ITEM))}function m(){for(;"="===Z;)g();j(e()?N.ATX_END:N.ATX)}function n(){d(1)?(g(2),j(N.UL_ITEM)):c("+}")&&(g(3),j(N.INS_END))}function o(){if(d(1))g(2),j(N.UL_ITEM);else if("*"!==b(1)||c("***")){if(c("***")){for(;"*"===Z;)g();e()&&j(N.ASIDE_DELIM)}}else g(2),j(N.BOLD)}function p(){"!"===b(1)?(g(2),j(N.TH)):"<"===b(1)&&A.ALLOW_IMG&&(g(2),j(N.LINK_IMG))}function q(){if("|"===b(1))g(2),j(N.TD);else if("="===b(1)){for(g();"="===Z;)g();e()&&j(N.TR_DELIM)}}function s(){if(c('""')){for(;'"'===Z;)g();j(N.CODE)}}function t(){"."===b(1)&&d(2)?(g(3),j(N.OL_ITEM)):"<"===b(1)&&A.ALLOW_LINK?(g(2),j(N.LINK_WIKI)):"["===b(1)&&A.ALLOW_LINK&&(g(2),j(N.LINK_INT))}function u(){for(;K.test(Z);)g();"."===b()&&d(1)&&(g(2),j(N.OL_ITEM))}function v(){"^"===b(1)&&(g(2),j(N.SUP))}function w(){","===b(1)&&(g(2),j(N.SUB))}function x(){"_"===b(1)&&(g(2),j(N.UNDER))}function y(){"<"===b(1)&&A.ALLOW_LINK&&(g(2),j(N.LINK_EXT))}function z(){g(),j(N.BRACKET_L)}function B(){g(),j(N.BRACKET_R)}function C(){c("--")?(g(3),j(N.DEL)):c("++")&&(g(3),j(N.INS))}function D(){":"===b(1)&&(g(2),j(N.LINK_REF_END))}function F(){g(),j(N.GT_THAN)}function H(){e(1)?(g(),j(N.LABEL_STOP)):A.ALLOW_ID&&d(1)?(g(2),j(N.LABEL_ID)):A.ALLOW_CLASS&&"."===b(1)&&d(2)&&(g(3),j(N.LABEL_CLASS))}function I(){"'"===b(1)&&(g(2),j(N.ITAL))}function J(){if(c("///")){for(;"/"===Z;)g();e()&&j(N.COMMENT_DELIM)}}function M(){d(1)&&(g(2),j(N.DT_MARK))}function O(){d(1)?(g(2),j(N.DD_MARK)):"{"===b(1)&&(g(2),j(N.LINK_REF))}function P(){for(;!ab[Z]&&!f()&&i();)g();j(N.TEXT)}function Q(){for(;E.test(Z);)g();j(N.SPACES)}function R(){"\r"===Z&&"\n"===b(1)?(g(2),_["\r\n"]=(_[Z]||0)+1):(g(1),_[Z]=(_[Z]||0)+1),j(N.NL),X=1}function S(){h(),f()?d()?Q():R():(g(),P(N.TEXT))}for(var T=null,U=[],V=1,W=0,X=1,Y=0,Z=a.charAt(Y),$=null,_={"\r\n":0,"\n":0,"\r":0},ab={"[":z,"]":B,"{":C,"}":D,":":O,";":M,"-":l,"=":m,"|":q,"!":p,"#":t,"+":n,"*":o,"^":v,",":w,_:x,"'":I,">":F,"?":y,".":H,"/":J,'"':s,"\\":S,"•":k,"⁃":k};i();)ab[Z]?ab[Z]():E.test(Z)?Q():G.test(Z)?R():K.test(Z)?u():P(),Y===W&&g(),$===T&&P(),Z=a.charAt(Y),$=T,V=X,W=Y;j(N.EOF);var bb=0;for(var cb in _)_[cb]>bb&&(bb=_[cb],L=cb);return"\r\n"!==L&&"\r"!==L&&"\n"!==L&&(L="\n"),U}function u(a){function b(){return a[cb+1]&&(cb+=1,db=a[cb]),cb}function c(b){return a[b]&&(cb=b,db=a[cb]),cb}function d(b,c){var d=c?c+cb:cb;return a[d]?a[d].isType(b):!1}function e(a){var b=a||0;return d(N.NL,b)||d(N.EOF,b)}function g(){return db instanceof r&&!d(N.EOF)}function j(a){var b=d(N.SPACES);return b&&l()&&(db.lexeme=db.substring(a-1,db.getLength())),b}function k(a){if(!g()||m())return!0;if(db.col<a&&!d(N.SPACES)&&!e())return!0;var b=T[db.type],c=l()&&p();return b&&c}function l(){return e(-1)||d(N.SPACES,-1)&&e(-2)}function m(){var a=0;return e(a)?e(a+1)?!0:d(N.SPACES,a+1)&&e(a+2):!1}function n(a){return l()&&db.col===a?d(N.DIV_LINE)||d(N.ATX_END):!1}function p(){return e(1)||d(N.SPACES,1)&&e(2)}function q(a,b){var c=b?b:db;return a?(X[c.type]?a.push(0):Y[c.type]&&a.pop(),a.length<=0):!1}function t(a){return d(N.GT_THAN)&&U[a.type]}function u(a){return l()&&db.col===a.col&&p()?db.isSameType(a)&&db.lexeme===a.lexeme:!1}function v(a){return db!==a&&db.isSameType(a)?d(N.CODE)&&db.lexeme==a.lexeme:!1}function w(){var a=0;return d(N.SPACES,a)&&(a+=1),d(N.NL,a)&&(a+=1),d(N.SPACES,a)&&(a+=1),d(N.LINK_CONT,a)}function x(b,c){for(var d="",e=b;c>e&&a[e]instanceof r;e+=1)d+=a[e].lexeme;return d}function y(a,c){for(var d=cb;g()&&!a[db.type];)b();return c?x(d,cb):void 0}function z(a,c){for(var d=cb;!e();)b();return c&&b(),a?x(d,cb):void 0}function B(){for(;d(N.SPACES)||d(N.NL);)b()}function C(){var a=db,b=new s(O.ASIDE);for(z(!1,!0),B();g()&&db.col>=a.col;){if(u(a)){z();break}b.addNode(E()),B()}return b}function D(){var a=db.lexeme.length,d=cb;b();var e=f(y(V,!0));if(z(),0===e.length)return c(d),db.type=N.TEXT,null;var g=new s(O.HEADER);return g.addText(e),g.meta.HEADERLVL=a,g}function E(){var a=null,b=eb<A.MAX_BLOCKS;if(B(),P[db.type]&&b)eb+=1,a=I(),eb-=1;else{if(d(N.LABEL_ID)||d(N.LABEL_CLASS))return H();if(d(N.CODE)&&d(N.NL,1))a=F();else if(d(N.ASIDE_DELIM)&&b)eb+=1,a=C(),eb-=1;else if(d(N.ATX))a=D();else if(d(N.LINK_REF))a=J();else{if(d(N.COMMENT_DELIM))return G(),a;d(N.TR_DELIM)?(z(),a=new s(O.TR)):d(N.LABEL_STOP)?(z(),a=new s(O.STOP)):d(N.DIV_LINE)?(z(),a=new s(O.DIV_LINE)):d(N.ATX_END)&&(db.type=N.TEXT)}}return!a&&g()&&(B(),a=K()),a}function F(){var a=new s(O.CODE_BLOCK),c=db;z(!1,!0);for(var e=cb,f=cb;g()&&(j(c.col),!u(c));)f=b();return d(N.SPACES,-1)&&(f-=1),a.addText(x(e,f)),e>=f&&a.addText(L),z(),a}function G(){for(var a=db;g();)if(z(),B(),u(a)){z();break}}function H(){var a=db.isType(N.LABEL_ID);b();var c=i(z(!0,!1));return 0===c.length||a&&fb[c]?null:(a&&(fb[c]=c),new s(a?O.ID:O.CLASS,{ID:c}))}function I(){var a=new s(P[db.type]);if(b(),d(N.SPACES)&&b(),e())return a;if(a.isType(O.DT))return a.addNodes(K()),a;for(var c=db.col;g()&&db.col>=c;)a.addNode(E()),B();return a}function J(){var a=cb,e="",f="";return b(),e=h(y(W,!0)),d(N.LINK_REF_END)?(b(),f=h(z(!0)),0===e.length||0===f.length?(c(a),K()):new s(O.LINK_REF,{REF_ID:e,URL:f})):(c(a),K())}function K(a,c,e,f){for(var g=c?c:[],h=a||db.col,i=new s(O.PARA),l=cb,m=cb,p=db,r=!1,t=null;!k(h)&&(j(h),r||!q(e,p));){if(R[p.type]){var u=o(g,p.type);if(u>=0){u===g.length-1&&(i.type=R[p.type]);break}var v=S[p.type],y=g.length>=A.MAX_SPANS;v&&!y&&(b(),g.push(v),t=K(h,g,e,f),g.pop(),t.err=t.isType(O.PARA))}else if(Q[p.type])t=_(h,f);else if(p.isType(N.CODE))t=$(h);else if(r&&p.isType(N.LINK_CONT)){var z=M(h,i.getLast());z===i.getLast()?l=cb+1:t=z,r=!1}t instanceof s?(t.err?m+=1:k(h)||(b(),r=Z[t.type]&&w()),i.addText(x(l,m)),i.addNode(t),l=cb):b(),m=cb,p=db,t=null}return!c&&n(h)&&(i.type=O.HEADER,i.meta.HEADERLVL=d(N.ATX_END)?1:2,b()),i.addText(x(l,m)),i}function M(a,c){if(!(c instanceof s&&Z[c.type]))return null;var d=null;if(c.isType(O.LINK_IMG)){if(d=ab(a),d.err)return d;c.meta.ALT=d.meta.TEXT}else{var e=[0];if(b(),d=K(a,[],e,!0),0!==e.length)return d.err=!0,d;c.addNodes(d)}return c}function $(a){var b=ab(a);if(b.err)return b;var c=new s(O.CODE);return c.addNode(b),c}function _(a,b){var c=db,d=c.isType(N.LINK_IMG);if(b&&!d)return null;var e=ab(a);return e.err||(e.type=Q[c.type],e.meta.URL=h(e.meta.TEXT),e.err=0===e.meta.URL.length,e.err?(e.type=O.TEXT,delete e.meta.URL):(delete e.meta.TEXT,d&&(e.meta.ALT=""))),e}function ab(a){var c=new s(O.TEXT),d=db,e=cb+1,f=X[d.type]?[0]:null;for(c.err=!0,b();!k(a);){if(j(a),q(f)||v(d)||t(d)){c.err=!1;break}b()}return c.meta.TEXT=x(e,cb),c}for(var bb=new s(O.ROOT),cb=0,db=a[cb],eb=0,fb=Object.create(null);g();)bb.addNode(E());return bb}function v(a){function b(a){for(var b=a.getLast();b&&b.isType(O.TR)&&0===b.getLength();)a.pop(),b=a.getLast();for(var c=a.getFirst().getLength(),d=0,e=a.getLength();e>d;d+=1){for(var f=a.children[d];f.getLength()>c;)f.pop();for(;f.getLength()<c&&f.getLength()>0;)f.addNode_simple(new s(O.TD));f.isDeleted=f.getLength()<=0}}function c(a){for(var b=a.getLast();b&&b.isType(O.DT);)a.pop(),b=a.getLast();for(var c=a.getFirst();c&&c.isType(O.DD);)a.popFirst(),c=a.getFirst();a.isDeleted=0===a.getLength()}function d(a){var b=0,c=0,f=null;for(b=0,c=a.getLength();c>b&&(f=a.children[b],!f.isType(O.TEXT)||J.test(f.meta.TEXT))&&(!(f.getLength()>0||Z[f.type])||(d(f),f.isDeleted));b+=1);if(a.isDeleted=b>=c&&!Z[a.type],!a.isDeleted&&(Z[a.type]&&1===a.getLength()&&(f=a.getLast(),f.isType(O.TEXT)&&J.test(f.meta.TEXT)&&a.pop()),A.RM_EOL))for(b=0,c=a.getLength();c>b;b+=1)f=a.children[b],f.isType(N.TEXT)&&(f.meta.TEXT=e(f.meta.TEXT))}function f(a){for(var e=0,i=a.getLength();i>e;e+=1){var j=a.children[e];if(j.isType(O.TABLE)&&b(j),j.isType(O.DL)&&c(j),j.isType(O.TEXT)||$[j.type]||Z[j.type]){if(d(a),!a.isDeleted){var k=a.getLast();k.isType(O.TEXT)&&(k.meta.TEXT=g(k.meta.TEXT))}return}j.getLength()>0&&!j.isType(O.CODE_BLOCK)&&f(j),j.isDeleted=_[j.type]&&j.getLength()<=0}h(a)}function h(a){var b=a.getLength()-1;for(b;b>=0;b-=1){var c=a.children[b];if(!c.isDeleted&&!ab[c.type])break;a.pop()}a.isDeleted=0>b&&!Z[a.type]}function i(a){return a.isDeleted?!1:(a.children=p(a.children,i),(_[a.type]||$[a.type])&&(a.isDeleted=a.getLength()<=0),!a.isDeleted)}return f(a),a.children=p(a.children,i),a}function w(a){return v(u(t(a)))}function x(c){function d(a,b){if(!bb[a.type])return"";var c=bb[a.type],d="<"+c;if(a.isType(O.HEADER)&&a.meta.HEADERLVL){var e=a.meta.HEADERLVL+A.MIN_HEADER;d+=e>6?"6":e+""}if(b)for(var f in b)b[f]=b[f].substring(0,A.MAX_ATTR_CHARS),d+=" "+f+'="'+l(b[f])+'"';return cb[a.type]&&A.XHTML&&(d+="/"),d+=">",a.isType(O.CODE_BLOCK)&&(d+="<code>"),d}function e(a){if(!bb[a.type])return"";var b=bb[a.type];if(a.isType(O.HEADER)&&a.meta.HEADERLVL){var c=a.meta.HEADERLVL+A.MIN_HEADER;b+=c>6?"6":c+""}return a.isType(O.CODE_BLOCK)?"</code></"+b+">":"</"+b+">"}function f(a){return a instanceof s&&a.meta.TEXT?A.XHTML?j(a.meta.TEXT):k(a.meta.TEXT):""}function g(a){for(var c=a.meta.URL,f=a.isType(O.LINK_IMG),g=a.meta.ALT,j=a.parent,l=!1;j;){if(Z[j.type]&&(l=!0),j.meta.SYM_TABLE&&j.meta.SYM_TABLE[c]){c=j.meta.SYM_TABLE[c];break}j=j.parent}a.isType(O.LINK_INT)&&(c="#"+b(c,!0)),f&&J.test(g)&&l&&(g=c);var m=f?{src:c,alt:g}:{href:c};return f?d(a,m):(a.isType(O.LINK_WIKI)&&(m["class"]=i(A.CSS_WIKI)),a.getLength()>0?d(a,m)+h(a,m)+e(a):d(a,m)+k(a.meta.URL)+e(a))}function h(a){var b=a.getLength(),c=0,i="";for(c=0;b>c;c+=1){var j=a.children[c];i+=Z[j.type]?g(j):$[j.type]?d(j)+h(j)+e(j):f(j)}return i}function m(a,b,c){return n(M,c)+d(a,b)+L}function o(c,f,g,i){var j=c.getLength(),k=0,l=null,p="",q=null,r=null,s=null,t="",u=d(c,f),v=e(c,f),w=n(M,g);for(k=0;j>k;k+=1)if(l=c.children[k],l.isType(O.ID))s=b(l.meta.ID);else if(l.isType(O.CLASS))q=q?q:[],q.push(l.meta.ID);else{if((s||q)&&(r=Object.create(null),s&&(r.id=s),q&&(r["class"]=a(q,!0))),s=null,q=null,l.isType(O.DIV_LINE))p+=m(l,f,g);else{if(l.isType(O.TEXT)||$[l.type]||Z[l.type]){p+=h(c);break}p+=o(l,r,g+1,k===j-1)}r=null}if(c.isType(O.CODE_BLOCK))t=u+p+v;else{if(c.isType(O.ROOT))return p;t=w+u+L+p+L+w+v}return i||(t+=L),t}return o(c,null,-1,!1)}function y(a){return q(A,a)}function z(a,b){var c=q(Object.create(null),A);y(b);var d=x(w(a));return A=c,d}var A={RM_EOL:0,MAX_ATTR_CHARS:2048,MAX_BLOCKS:8,MAX_SPANS:10,ALLOW_IMG:1,ALLOW_LINK:1,ALLOW_CLASS:1,ALLOW_ID:1,CSS_PRE_ID:"bbm-",CSS_PRE:"bbm-",CSS_WIKI:"w-bbm",MIN_HEADER:0,XHTML:0},B="[ \\u2000-\\u200d\\t\\u202f\\u205f\\u3000\\u1680\\u180e\\u00a0\\u00b7\\u237d\\u2420\\u2422\\u2423]+",C="[\\v\\f\\r\\n\\u0085\\u2028\\u2029]+",D="[\\u0000-\\u001f\\u007f-\\u009f\\u2028\\u2029]+",E=new RegExp(B),F=new RegExp(B,"g"),G=new RegExp(C),H=new RegExp(C,"g"),I=new RegExp(D,"g"),J=/^\s*$/,K=/[0-9]+/,L="\n",M=" ",N={SPACES:"SPACES",NL:"NL",TEXT:"TEXT",UNDER:"UNDER",SUB:"SUB",SUP:"SUP",CODE:"CODE",ITAL:"ITAL",BOLD:"BOLD",INS:"INS",INS_END:"INS_END",DEL:"DEL",DEL_END:"DEL_END",DIV_LINE:"DIV_LINE",COMMENT_DELIM:"COMMENT_DELIM",ASIDE_DELIM:"ASIDE_DELIM",TH:"TH",TD:"TD",TR_DELIM:"TR_DELIM",ATX:"ATX",ATX_END:"ATX_END",OL_ITEM:"OL_ITEM",UL_ITEM:"UL_ITEM",DT_MARK:"DT_MARK",DD_MARK:"DD_MARK",LABEL_CLASS:"LABEL_CLASS",LABEL_ID:"LABEL_ID",LABEL_STOP:"LABEL_STOP",LINK_REF_END:"LINK_REF_END",LINK_REF:"LINK_REF",LINK_CONT:"LINK_CONT",LINK_INT:"LINK_INT",LINK_WIKI:"LINK_WIKI",LINK_EXT:"LINK_EXT",LINK_IMG:"LINK_IMG",GT_THAN:"GT_THAN",BRACKET_L:"BRACKET_L",BRACKET_R:"BRACKET_R",EOF:"EOF"},O={ROOT:"ROOT",PARA:"PARA",STOP:"STOP",BLOCKQUOTE:"BLOCKQUOTE",CODE_BLOCK:"CODE_BLOCK",ASIDE:"ASIDE",ID:"ID",CLASS:"CLASS",UL:"UL",OL:"OL",UL_LI:"UL_LI",OL_LI:"OL_LI",HEADER:"HEADER",DIV_LINE:"DIV_LINE",DT:"DT",DD:"DD",DL:"DL",TH:"TH",TD:"TD",TR:"TR",TABLE:"TABLE",LINK_REF:"LINK_REF",LINK_INT:"LINK_INT",LINK_EXT:"LINK_EXT",LINK_IMG:"LINK_IMG",LINK_WIKI:"LINK_WIKI",TEXT:"TEXT",DEL:"DEL",INS:"INS",UNDER:"UNDER",SUB:"SUB",SUP:"SUP",ITAL:"ITAL",BOLD:"BOLD",CODE:"CODE"},P={GT_THAN:O.BLOCKQUOTE,UL_ITEM:O.UL_LI,OL_ITEM:O.OL_LI,DT_MARK:O.DT,DD_MARK:O.DD,TH:O.TH,TD:O.TD},Q={LINK_INT:O.LINK_INT,LINK_EXT:O.LINK_EXT,LINK_IMG:O.LINK_IMG,LINK_WIKI:O.LINK_WIKI},R={INS:O.INS,DEL:O.DEL,INS_END:O.INS,DEL_END:O.DEL,BOLD:O.BOLD,ITAL:O.ITAL,SUP:O.SUP,SUB:O.SUB,UNDER:O.UNDER},S={INS:N.INS_END,DEL:N.DEL_END,BOLD:N.BOLD,ITAL:N.ITAL,SUP:N.SUP,SUB:N.SUB,UNDER:N.UNDER},T={ASIDE_DELIM:1,ATX_END:1,DIV_LINE:1},U={LINK_EXT:1,LINK_IMG:1,LINK_WIKI:1},V={ATX_END:1,NL:1},W={LINK_REF_END:1,NL:1},X={BRACKET_L:1,LINK_INT:1,LINK_CONT:1},Y={BRACKET_R:1},Z={LINK_IMG:1,LINK_EXT:1,LINK_INT:1,LINK_WIKI:1},$={SUB:1,SUP:1,ITAL:1,BOLD:1,DEL:1,INS:1,UNDER:1,CODE:1},_={STOP:1,PARA:1,BLOCKQUOTE:1,ASIDE:1,UL_LI:1,OL_LI:1,HEADER:1,OL:1,UL:1,DL:1,DD:1,DT:1,TR:1},ab={ID:1,CLASS:1,STOP:1},bb={PARA:"p",BLOCKQUOTE:"blockquote",CODE_BLOCK:"pre",ASIDE:"div",UL_LI:"li",OL_LI:"li",OL:"ol",UL:"ul",DL:"dl",DD:"dd",DT:"dt",DIV_LINE:"hr",TH:"th",TD:"td",TR:"tr",TABLE:"table",LINK_INT:"a",LINK_EXT:"a",LINK_WIKI:"a",LINK_IMG:"img",SUB:"sub",SUP:"sup",ITAL:"em",BOLD:"strong",DEL:"del",INS:"ins",UNDER:"u",CODE:"code",HEADER:"h"},cb={LINK_IMG:1,DIV_LINE:1};return function(){var a=function(){};Object.create=Object.create||function(b){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof b)throw TypeError("Argument must be an object");return a.prototype=b,new a}}(),r.prototype={isType:function(a){return this.type===a},isSameType:function(a){return this.type===a.type},substring:function(a,b){return this.lexeme.substring(a,b)},getLength:function(){return this.lexeme.length}},s.prototype={getLast:function(){return this.children[this.children.length-1]},getFirst:function(){return this.children[0]},getLength:function(){return this.children.length},isType:function(a){return this.type===a},isSameType:function(a){return this.type===a.type},pop:function(){this.children.pop()},popFirst:function(){this.children.shift()},addNode_simple:function(a){var b=this.getLast();return b&&b.isType(O.TEXT)&&b.isSameType(a)?void(b.meta.TEXT+=a.meta.TEXT):(a.parent=this,void this.children.push(a))},addNode_table:function(a){var b=this.getLast();if(!b||!b.isType(O.TABLE)){if(a.isType(O.TR))return;b=new s(O.TABLE),this.addNode_simple(b)}b.getLength()<=0&&b.addNode_simple(new s(O.TR));var c=b.getLast();a.isType(O.TH)||a.isType(O.TD)?c.addNode_simple(a):a.isType(O.TR)&&c.getLength()>0&&b.addNode_simple(a)},addNode_ul_ol:function(a){var b=a.isType(O.UL_LI)?O.UL:O.OL,c=this.getLast();c&&c.isType(b)||(c=new s(b),this.addNode_simple(c)),c.addNode_simple(a)},addNode_dl:function(a){var b=this.getLast();b&&b.isType(O.DL)||(b=new s(O.DL),this.addNode_simple(b)),b.addNode_simple(a)},addNode:function(a){a instanceof s&&a!==this&&(a.isType(O.LINK_REF)?(this.meta.SYM_TABLE=this.meta.SYM_TABLE||Object.create(null),this.meta.SYM_TABLE[a.meta.REF_ID]=a.meta.URL):this.isType(O.PARA)&&this.isSameType(a)?this.addNodes(a):a.isType(O.UL_LI)||a.isType(O.OL_LI)?this.addNode_ul_ol(a):a.isType(O.TR)||a.isType(O.TH)||a.isType(O.TD)?this.addNode_table(a):a.isType(O.DD)||a.isType(O.DT)?this.addNode_dl(a):this.addNode_simple(a))},addText:function(a){a&&a.length>0&&this.addNode_simple(new s(O.TEXT,{TEXT:a}))},addNodes:function(a){if(a instanceof s&&a!==this)for(var b=0,c=a.children.length;c>b;b+=1)this.addNode_simple(a.children[b])}},{lexer:t,parser:u,filter:v,frontEnd:w,compile:z,setOptions:y,AST_ENUM:O,LEX_ENUM:N,ASTNode:function(a,b){return new s(a,b)},LexToken:function(a,b,c){return new r(a,b,c)}}}();"undefined"!=typeof module&&(module.exports=BBM);